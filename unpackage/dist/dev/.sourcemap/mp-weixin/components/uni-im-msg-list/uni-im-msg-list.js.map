{"version":3,"sources":["webpack:///H:/private/AIproject/psychic/assistant-client-front-end/components/uni-im-msg-list/uni-im-msg-list.vue?dc25","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/components/uni-im-msg-list/uni-im-msg-list.vue?73d4","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/components/uni-im-msg-list/uni-im-msg-list.vue?b3db","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/components/uni-im-msg-list/uni-im-msg-list.vue?3291","uni-app:///components/uni-im-msg-list/uni-im-msg-list.vue","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/components/uni-im-msg-list/uni-im-msg-list.vue?238a","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/components/uni-im-msg-list/uni-im-msg-list.vue?58be"],"names":["components","uniImList","uniImListItem","computed","currentConversationId","systemInfo","isWidescreen","msgList","conversation","loadState","current_uid","currentConversation","msgManagers","isSafariPc","props","paddingBottom","default","data","scrollIntoView","scrollTop","old","hasMore","tasksList","mounted","methods","init","console","isInit","loadMore","conversation_id","action","doTasksListBefore","setTimeout","doTasksList","showLast","onScroll","debounce","showControl","retriesSendMsg","getConversation","clearUnreadCount","setMsgList","getMsgManager","loadConversation","setCurrentConversationId","updateConversation","updateMsgManager","addMsgManager","timers"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAwI;AACxI;AACmE;AACL;AACsC;;;AAGpG;AAC+K;AAC/K,gBAAgB,wLAAU;AAC1B,EAAE,qFAAM;AACR,EAAE,sGAAM;AACR,EAAE,+GAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,0GAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,aAAa,oPAEN;AACP,KAAK;AACL;AACA,aAAa,0PAEN;AACP,KAAK;AACL;AACA,aAAa,0VAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AClEA;AAAA;AAAA;AAAA;AAA2pB,CAAgB,grBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;AC6C/qB;AAOA;AAEA;AAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eAQA;EACAA;IACAC;IACAC;EACA;EACAC,wDACA;IACAC;MAAA;IAAA;IACAC;MAAA;IAAA;IACAC;MAAA;IAAA;IACAC;MAAA;IAAA;EACA,KACA;IACAC;EACA;IACAC;MACA;IACA;IACA;IACAC;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;MACA;MACA;QACAA;MACA;MACA;IACA;IACAC;MAIA;IACA;EAAA,EACA;EACA;EACA;EACA;EACA;EACA;EACAC;IACAC;MACAC;IACA;EACA;EACAC;IACA;MACAC;MACAC;MACAC;QACAD;MACA;MACAE;MACAC;IACA;EACA;EACAC;IAAA;MAAA;QAAA;UAAA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAMA,EALA;EACA;EACA;EACA;EACA;EAAA;;EAEAC;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBACA;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBACAC;gBAAA;gBAAA,OACA;cAAA;gBACA;kBAAA;oBAAA;sBAAA;wBAAA;0BACA;0BACA;4BACAC;0BACA;wBAAA;wBAAA;0BAAA;sBAAA;oBAAA;kBAAA;gBAAA,CACA;gBACA;gBAAA;gBAAA;cAAA;gBAEA;kBACA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAKA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA,kCAEA;cAAA;gBAEA;gBAAA;gBAAA,OACA;cAAA;gBAAAX;gBACA;gBACA;;gBAEA;gBACA;kBACA;oBACAY;oBACAC;oBACAb;kBACA;kBACA;oBAAA;sBAAA;wBAAA;0BAAA;4BACA;4BAAA,MACA;8BAAA;8BAAA;4BAAA;4BACA;4BACA;4BAAA;4BAAA,OACA;0BAAA;0BAAA;4BAAA;wBAAA;sBAAA;oBAAA;kBAAA,CAEA;kBACA;gBACA;;gBACA;gBAAA,kCAEAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACAc;MAAA;MACA;;MAEA;QACA;;QAGA;UACA;UACA;UACA;YACA;YACA;YACAC;cACA;YACA;UACA;QACA;QAGA;MACA;IACA;IACAC;MACA;MACA;QAAA;MAAA;MACA;IACA;IACAC;MAAA;MAAA;MACA;QAEA;QACA;UACA;QACA;MAeA;IACA;IACAC;MAAA;MAQA;MACA;QACA;MACA;MACAC;QACA;QACAJ;UACA;YACA;UACA;QACA;MACA;IACA;IACAK;MACA;IACA;IACAC;MACA;IACA;EAAA,GACA;IACA;IACAC;IACAC;IACAC;IACAC;IACAC;EACA,KACA;IACAC;IACAC;IACAC;IACAC;EACA;AAEA;AAAA;AAEA;AAEA;EACA;IACA;MACAC;QAAA;MAAA;IACA;IACA;IACAA;EACA;AACA,C;;;;;;;;;;;;ACxSA;AAAA;AAAA;AAAA;AAAswC,CAAgB,muCAAG,EAAC,C;;;;;;;;;;;ACA1xC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/uni-im-msg-list/uni-im-msg-list.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./uni-im-msg-list.vue?vue&type=template&id=6912f79c&scoped=true&\"\nvar renderjs\nimport script from \"./uni-im-msg-list.vue?vue&type=script&lang=js&\"\nexport * from \"./uni-im-msg-list.vue?vue&type=script&lang=js&\"\nimport style0 from \"./uni-im-msg-list.vue?vue&type=style&index=0&id=6912f79c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6912f79c\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/uni-im-msg-list/uni-im-msg-list.vue\"\nexport default component.exports","export * from \"-!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-im-msg-list.vue?vue&type=template&id=6912f79c&scoped=true&\"","var components\ntry {\n  components = {\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n    uniImFormatTime: function () {\n      return import(\n        /* webpackChunkName: \"components/uni-im-format-time/uni-im-format-time\" */ \"@/components/uni-im-format-time/uni-im-format-time.vue\"\n      )\n    },\n    uniImMsg: function () {\n      return import(\n        /* webpackChunkName: \"components/uni-im-msg/uni-im-msg\" */ \"@/components/uni-im-msg/uni-im-msg.vue\"\n      )\n    },\n    uniLoadMore: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-load-more/components/uni-load-more/uni-load-more\" */ \"@/uni_modules/uni-load-more/components/uni-load-more/uni-load-more.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.msgList.length\n  var g1 = _vm.currentConversationId && _vm.msgList.length == 0\n  var a0 = g1\n    ? {\n        contentrefresh: \"加载中\",\n        contentnomore: \"- 没有聊天记录 -\",\n      }\n    : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        a0: a0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-im-msg-list.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-im-msg-list.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"root\">\r\n\t\t<uni-im-list v-if=\"msgList.length\" class=\"uni-im-list\" @scroll=\"onScroll\" :scroll-top=\"scrollTop\"\r\n\t\t\t:scroll-into-view=\"scrollIntoView\" :paddingBottom=\"paddingBottom\" ref=\"uni-im-list\">\r\n\t\t\t<uni-im-list-item v-for=\"(msg,index) in msgList\" :key=\"msg._id\" ref=\"uni-im-list-item\">\r\n\t\t\t\t<view class=\"item\" :id=\"'item-'+index\">\r\n\t\t\t\t\t<view v-if=\"index === 0\" class=\"data-state-tip-box\" @appear=\"loadMore\">\r\n\t\t\t\t\t\t<template v-if=\"isSafariPc\">\r\n\t\t\t\t\t\t\t<button v-if=\"hasMore\" class=\"loadMore-btn\" @click=\"loadMore\">点击加载更多</button>\r\n\t\t\t\t\t\t\t<text v-else class=\"data-state-tip-text\">没有更多历史消息</text>\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t<template v-else>\r\n\t\t\t\t\t\t\t<!-- vue2下小程序端 加载状态如果使用组件会有 滚动锚定问题 其他端可以使用 uni-load-more -->\r\n\t\t\t\t\t\t\t<uni-icons v-if=\"hasMore\" size=\"25px\" color=\"#ccc\" type=\"spinner-cycle\"\r\n\t\t\t\t\t\t\t\tclass=\"data-state-tip-icon\" />\r\n\t\t\t\t\t\t\t<text class=\"data-state-tip-text\">{{hasMore ? '正在加载历史消息' : '没有更多历史消息' }}</text>\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-if=\"msg.type == 'system'\" class=\"system-msg-box\">\r\n\t\t\t\t\t\t<text class=\"system-msg\">{{msg.text}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<template v-else>\r\n\t\t\t\t\t\t<uni-im-format-time :index=\"index\" :msgList=\"msgList\" />\r\n\t\t\t\t\t\t<uni-im-msg :msg=\"msg\" :self=\"msg.self\" :index=\"index\"\r\n\t\t\t\t\t\t\t@showControl=\"showControl\" @retriesSendMsg=\"retriesSendMsg\"\r\n\t\t\t\t\t\t\t:avatar_file=\"currentConversation.avatar_file\" ref=\"uni-im-msg\" class=\"uni-im-msg\">\r\n\t\t\t\t\t\t</uni-im-msg>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</view>\r\n\t\t\t</uni-im-list-item>\r\n\t\t</uni-im-list>\r\n\t\t<uni-load-more v-if=\"currentConversationId && msgList.length == 0\" :status=\"hasMore?'loading':'noMore'\"\r\n\t\t\tclass=\"mg-15\" :contentText='{\"contentrefresh\": \"加载中\",\"contentnomore\": \"- 没有聊天记录 -\"}' />\r\n\t\t<!-- <view style=\"position: fixed;top: 100px;width: 400rpx;\">\r\n\t\t\tpaddingBottom：{{paddingBottom}}\r\n\t\t\tscrollTop：{{scrollTop}}\r\n\t\t\tmsgList.length:{{msgList.length}}\r\n\t\t\tthis.loadMore.lock：{{loadMore.lock}}\r\n\t\t\tscrollIntoView:{{scrollIntoView}}\r\n\t\t\t<button @click=\"showLast\">showLast</button>\r\n\t\t</view> -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapMutations,\r\n\t\tmapGetters,\r\n\t\tmapActions\r\n\t} from 'vuex';\r\n\r\n\timport { store as uniIdStore } from '@/uni_modules/uni-id-pages/common/store';\r\n\r\n\timport MsgManager from '@/common/msgManager.js';\r\n\r\n\timport uniImList from './components/uni-im-list/uni-im-list';\r\n\timport uniImListItem from './components/uni-im-list-item/uni-im-list-item';\r\n\r\n\t// #ifdef APP-NVUE\r\n\tconst nativePluginDom = uni.requireNativePlugin('dom')\r\n\t// #endif\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tuniImList,\r\n\t\t\tuniImListItem\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState({\r\n\t\t\t\tcurrentConversationId: state => state.uniIm.currentConversationId,\r\n\t\t\t\tsystemInfo: state => state.uniIm.systemInfo,\r\n\t\t\t\tisWidescreen: state => state.uniIm.isWidescreen,\r\n\t\t\t\tmsgList: state => state.uniIm.msgList\r\n\t\t\t}),\r\n\t\t\t...mapGetters({\r\n\t\t\t\tconversation: 'uniIm/conversation',\r\n\t\t\t}),\r\n\t\t\tloadState() {\r\n\t\t\t\treturn this.hasMore ? '正在加载历史消息' : '没有更多历史消息'\r\n\t\t\t},\r\n\t\t\t//当前用户自己的uid\r\n\t\t\tcurrent_uid() {\r\n\t\t\t\treturn uniIdStore.userInfo._id;\r\n\t\t\t},\r\n\t\t\tcurrentConversation() {\r\n\t\t\t\treturn this.conversation(this.currentConversationId) || {};\r\n\t\t\t},\r\n\t\t\tmsgManagers() {\r\n\t\t\t\tconst msgManagers = getApp().globalData.uniIm.msgManagers;\r\n\t\t\t\tlet msgManager = msgManagers[this.currentConversationId];\r\n\t\t\t\tif (!msgManager) {\r\n\t\t\t\t\tmsgManagers[this.currentConversationId] = new MsgManager(this.currentConversation);\r\n\t\t\t\t}\r\n\t\t\t\treturn msgManagers[this.currentConversationId] || {}\r\n\t\t\t},\r\n\t\t\tisSafariPc() {\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\treturn this.systemInfo.browserName == 'safari' && this.isWidescreen\r\n\t\t\t\t// #endif\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t},\r\n\t\t// watch: {\r\n\t\t// \t\"currentConversation.msgList\"(data) {\r\n\t\t// \t\tthis.msgList = data\r\n\t\t// \t}\r\n\t\t// },\r\n\t\tprops: {\r\n\t\t\tpaddingBottom: {\r\n\t\t\t\tdefault: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tscrollIntoView: '',\r\n\t\t\t\tscrollTop: 0,\r\n\t\t\t\told: {\r\n\t\t\t\t\tscrollTop: 0\r\n\t\t\t\t},\r\n\t\t\t\thasMore: false,\r\n\t\t\t\ttasksList: []\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync mounted() {\r\n\t\t\t// for (var i = 0; i < 10; i++) {\r\n\t\t\t// \tthis.msgList.unshift({\r\n\t\t\t// \t\tt:i\r\n\t\t\t// \t})\r\n\t\t\t// }\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tasync init() {\r\n\t\t\t\t// init data --start\r\n\t\t\t\tthis.scrollIntoView = ''\r\n\t\t\t\tthis.scrollTop = 0\r\n\t\t\t\tthis.old.scrollTop = 0\r\n\t\t\t\tthis.hasMore = true\r\n\t\t\t\tthis.tasksList = []\r\n\t\t\t\tthis.loadMore.lock = false\r\n\t\t\t\t// init data --end\r\n\t\t\t\tif (!this.msgList) {\r\n\t\t\t\t\tconsole.log(\"sss\")\r\n\t\t\t\t\tawait this.loadMore()\r\n\t\t\t\t\tthis.tasksList.push(async () => {\r\n\t\t\t\t\t\tthis.showLast(300)\r\n\t\t\t\t\t\tthis.updateConversation([this.currentConversationId, {\r\n\t\t\t\t\t\t\tisInit: true\r\n\t\t\t\t\t\t}]);\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.doTasksListBefore()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this.msgList.length < this.msgManagers.pageLimit) {\r\n\t\t\t\t\t\t// 加载过且少于一页 说明没有更多历史数据，否则先假设有滚动到最后一条，用户再次滚动到顶时会根据接口响应数据重新设定\r\n\t\t\t\t\t\tthis.hasMore = false\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tthis.showLast(300)\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tasync loadMore() {\r\n\t\t\t\tif (this.loadMore.lock || !this.hasMore) {\r\n\t\t\t\t\t// console.log('this.loadMore.lock，!this.hasMore', this.loadMore.lock,!this.hasMore);\r\n\t\t\t\t\treturn []\r\n\t\t\t\t}\r\n\t\t\t\tthis.loadMore.lock = true\r\n\t\t\t\tlet data = await this.msgManagers.getMore()\r\n\t\t\t\t// console.log('加载到数据：', data);\r\n\t\t\t\tthis.hasMore = (data.length != 0)\r\n\r\n\t\t\t\t// 添加到任务列再执行，解决滚动锚定的问题\r\n\t\t\t\tthis.tasksList.push(() => {\r\n\t\t\t\t\tthis.setMsgList({\r\n\t\t\t\t\t\tconversation_id: this.currentConversationId,\r\n\t\t\t\t\t\taction: this.currentConversation.isInit ? 'unshift' : 'set',\r\n\t\t\t\t\t\tdata\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.$nextTick(async() => {\r\n\t\t\t\t\t\tthis.loadMore.lock = false\r\n\t\t\t\t\t\tif (this.msgList.length < this.msgManagers.pageLimit && this.hasMore) {\r\n\t\t\t\t\t\t\t// 不满一页再拉取一遍\r\n\t\t\t\t\t\t\tthis.loadMore.lock = false\r\n\t\t\t\t\t\t\tawait this.loadMore()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// console.log('this.loadMore.lock-----',this.loadMore.lock);\r\n\t\t\t\t})\r\n\t\t\t\tthis.doTasksListBefore()\r\n\r\n\t\t\t\treturn data\r\n\t\t\t},\r\n\t\t\tdoTasksListBefore() {\r\n\t\t\t\t// console.log('doTasksListBefore');\r\n\t\t\t\t\r\n\t\t\t\tif (this.tasksList.length) {\r\n\t\t\t\t\t// 非APP端有滚动锚定问题，需要先滚动为非0高度再加载\r\n\t\t\t\t\t\r\n\t\t\t\t\t// #ifndef APP-NVUE\r\n\t\t\t\t\tif (this.old.scrollTop < 1 && !this.isSafariPc) {\r\n\t\t\t\t\t\t// console.log('小于1111');\r\n\t\t\t\t\t\tthis.scrollTop = this.old.scrollTop\r\n\t\t\t\t\t\treturn this.$nextTick(() => {\r\n\t\t\t\t\t\t\tthis.scrollTop = 1\r\n\t\t\t\t\t\t\tthis.old.scrollTop = 1\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tthis.doTasksList()\r\n\t\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.doTasksList()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdoTasksList() {\r\n\t\t\t\t// console.log('doTasksList', this.tasksList.length);\r\n\t\t\t\tthis.tasksList.forEach(fun => fun())\r\n\t\t\t\tthis.tasksList = []\r\n\t\t\t},\r\n\t\t\tshowLast(duration = 300) {\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t// #ifndef APP-NVUE\r\n\t\t\t\t\tthis.scrollIntoView = 'uni-im-list-last-item'\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\tthis.scrollIntoView = ''\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// #endif\r\n\r\n\t\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\t\tif (this.msgList.length) {\r\n\t\t\t\t\t\tlet target = this.$refs['uni-im-list'].$refs['uni-im-list-last-item'];\r\n\t\t\t\t\t\tconsole.log('滚动到最后一个', duration, target);\r\n\t\t\t\t\t\tnativePluginDom.scrollToElement(target, {\r\n\t\t\t\t\t\t\tanimated: duration != 0,\r\n\t\t\t\t\t\t\toffset: 999\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log('没有任何元素');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tonScroll(e) {\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\t// pc 端 safari浏览器有滚动锚定问题走点击加载\r\n\t\t\t\tif (this.isSafariPc) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\tthis.old.scrollTop = e.detail.scrollTop\r\n\t\t\t\tif (e.detail.scrollTop < 300) {\r\n\t\t\t\t\tthis.loadMore()\r\n\t\t\t\t}\r\n\t\t\t\tdebounce(()=>{\r\n\t\t\t\t\tthis.doTasksListBefore\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\tif (e.detail.scrollTop < 300) {\r\n\t\t\t\t\t\t\tthis.loadMore()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 1500);\r\n\t\t\t\t})()\r\n\t\t\t},\r\n\t\t\tshowControl(e) {\r\n\t\t\t\tthis.$emit('showControl', e)\r\n\t\t\t},\r\n\t\t\tretriesSendMsg(e) {\r\n\t\t\t\tthis.$emit('retriesSendMsg', e)\r\n\t\t\t},\r\n\t\t\t...mapActions({\r\n\t\t\t\t// 加载更多会话数据\r\n\t\t\t\tgetConversation: 'uniIm/getConversation',\r\n\t\t\t\tclearUnreadCount: 'uniIm/clearUnreadCount',\r\n\t\t\t\tsetMsgList: 'uniIm/setMsgList',\r\n\t\t\t\tgetMsgManager: 'uniIm/getMsgManager',\r\n\t\t\t\tloadConversation: 'uniIm/loadMoreConversation',\r\n\t\t\t}),\r\n\t\t\t...mapMutations({\r\n\t\t\t\tsetCurrentConversationId: 'uniIm/setCurrentConversationId',\r\n\t\t\t\tupdateConversation: 'uniIm/updateConversation',\r\n\t\t\t\tupdateMsgManager: 'uniIm/updateMsgManager',\r\n\t\t\t\taddMsgManager: 'uniIm/addMsgManager'\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tlet timers = []\r\n\r\n\tfunction debounce(fn, delay) {\r\n\t\treturn function() {\r\n\t\t\tif (timers.length) {\r\n\t\t\t\ttimers.forEach(timer => clearTimeout(timer))\r\n\t\t\t}\r\n\t\t\tlet timer = setTimeout(fn, delay);\r\n\t\t\ttimers.push(timer)\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.root,\r\n\t.uni-im-list {\r\n\t\tflex: 1;\r\n\t\tbackground-color: transparent;\r\n\t}\r\n\r\n\t.item {\r\n\t\tmargin: 15px 0;\r\n\t\t// border: solid 1px #f40000;\r\n\t}\r\n\r\n\t.mg-15 {\r\n\t\tmargin: 15px;\r\n\t}\r\n\r\n\t.data-state-tip-box {\r\n\t\t// height: 35px;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tflex-direction: row;\r\n\t\tcolor: #999999;\r\n\t}\r\n\r\n\t/* #ifndef APP-NVUE */\r\n\t.data-state-tip-icon {\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tdisplay: flex;\r\n\t\tanimation: rotation 1s linear infinite;\r\n\t}\r\n\r\n\t@keyframes rotation {\r\n\t\t0% {\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\r\n\t\t100% {\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n\r\n\t/* #endif */\r\n\r\n\t.data-state-tip-text {\r\n\t\theight: 36px;\r\n\t\tline-height: 36px;\r\n\t\tfont-size: 12px;\r\n\t\tmargin: 0 5px;\r\n\t\tcolor: #999999;\r\n\t}\r\n\r\n\t/* #ifdef H5 */\r\n\t.loadMore-btn {\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #666666;\r\n\t}\r\n\r\n\t.loadMore-btn::after {\r\n\t\tdisplay: none;\r\n\t}\r\n\r\n\t/* #endif */\r\n\r\n\t.system-msg-box {\r\n\t\tmargin-bottom: 10px;\r\n\t\talign-items: center;\r\n\t}\r\n\t.system-msg {\r\n\t\tbackground-color: #f2f2f2;\r\n\t\tcolor: #9d9e9d;\r\n\t\tfont-size: 14px;\r\n\t\theight: 30px;\r\n\t\tline-height: 30px;\r\n\t\tpadding: 0 15rpx;\r\n\t\tborder-radius: 8px;\r\n\t}\r\n</style>\r\n","import mod from \"-!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-im-msg-list.vue?vue&type=style&index=0&id=6912f79c&lang=scss&scoped=true&\"; export default mod; export * from \"-!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-im-msg-list.vue?vue&type=style&index=0&id=6912f79c&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1682514328523\n      var cssReload = require(\"G:/software/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}