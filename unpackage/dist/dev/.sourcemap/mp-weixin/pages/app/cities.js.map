{"version":3,"sources":["uni-app:///main.js","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/pages/app/cities.vue?262a","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/pages/app/cities.vue?990e","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/pages/app/cities.vue?4831","webpack:///H:/private/AIproject/psychic/assistant-client-front-end/pages/app/cities.vue?0111","uni-app:///pages/app/cities.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","localCity","limit","save","codeList","dataList","hotLetter","zhixiashi","onLoad","computed","isLogin","methods","loadData","db","result","console","letter","recommend","getLocationCallback","fromLatlng","name","realName","code","indexOf","getLocation","type","success","chooseCity","city","uni","key","select_city"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAmH;AACnH;AAC0D;AACL;;;AAGrD;AAC+K;AAC/K,gBAAgB,wLAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,iFAAM;AACR,EAAE,0FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAkpB,CAAgB,uqBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACOtqB;AAAA,eACA;EACAC;IACA;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;IACA;EACA;EACAC;IACA;MACA;IACA;IACA;EACA;EACAC;IACAC;MACA;IACA;EACA;EACAC;IACA;AACA;AACA;IACAC;MAAA;MACAC,+FACA,+CACA,0EAEA;QAAA,IADAC;QAEAC;QACA;QACA;QACA;QACA;QACAD;UACA;YACA;cACA;cACA;gBACAE;gBACAhB;cACA;YACA;YACA;YACAgB;YACAhB;UACA;UACA;UACA;YACAA;YACA;cACAiB;YACA;YACA;YACA;cACA;YACA;cACA;YACA;UACA;QACA;QACA;QACA;UACA;YACAD;YACAhB;UACA;QACA;QACA;QACA;UACAgB;UACAhB;QACA;QACA;QACA;MACA;IACA;IACAkB;MAAA;MACAH;MACA;MACA;QACAI;MACA;QACAJ;QACA;UACA;UACA;YACA;YACA;cACAK;cACAC;cACAC;YACA;UACA;YACA;cACAF;cACAC;cACAC;YACA;UACA;YACA;YACA;cACAF;cACAC;cACAC;YACA;UACA;UACAP;UACA;UACA;UACA;UACA;YACA;cAAA,cACAd,eACAsB;YAAA;YACA;cACA;YACA;YACA;UACA;YACA;cACAP;cACAhB,OACA;YAEA;UACA;QACA;MACA;IACA;IACAwB;MAAA;MAEA7B;QACA8B;QACAC;UACA;QACA;MACA;IASA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAZ;gBACAa;kBACAN;kBACAF;gBACA,GACA;gBACA;kBACAQ;gBACA;gBACAC;kBACAC;kBACA9B;gBACA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,OACAa;kBACAkB;gBACA;cAAA;gBACA;gBACA;cAAA;gBAEA;gBACA;gBACAF;gBACA;kBACA;kBACA;oBACAD;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;EACA;AACA;AAAA,2B","file":"pages/app/cities.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/app/cities.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./cities.vue?vue&type=template&id=0ed2dea0&\"\nvar renderjs\nimport script from \"./cities.vue?vue&type=script&lang=js&\"\nexport * from \"./cities.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/app/cities.vue\"\nexport default component.exports","export * from \"-!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./cities.vue?vue&type=template&id=0ed2dea0&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./cities.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\software\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./cities.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<uni-indexed-list :options=\"dataList\" :showSelect=\"false\" @click=\"chooseCity\"></uni-indexed-list>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tconst db = uniCloud.database();\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tlocalCity: {},\r\n\t\t\t\tlimit: 500,\r\n\t\t\t\tsave: false, //是否保存到用户信息里面\r\n\t\t\t\tcodeList: {},\r\n\t\t\t\tdataList: [],\r\n\t\t\t\thotLetter: \"热门\",\r\n\t\t\t\tzhixiashi: {\r\n\t\t\t\t\t\"北京市\": \"110000\",\r\n\t\t\t\t\t\"天津市\": \"120000\",\r\n\t\t\t\t\t\"重庆市\": \"500000\",\r\n\t\t\t\t\t\"上海市\": \"310000\",\r\n\t\t\t\t\t\"北京\": \"110000\",\r\n\t\t\t\t\t\"天津\": \"120000\",\r\n\t\t\t\t\t\"重庆\": \"500000\",\r\n\t\t\t\t\t\"上海\": \"310000\",\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tif (e.save) {\r\n\t\t\t\tthis.save = e.save;\r\n\t\t\t}\r\n\t\t\tthis.loadData();\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tisLogin() {\r\n\t\t\t\treturn this.$store.getters['user/isTokenValid'];\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 一次性查询所有城市，可以本地缓存一下\r\n\t\t\t */\r\n\t\t\tloadData() {\r\n\t\t\t\tdb.collection(\"opendb-city-china\").where(\"(type==1) || (type==2 && is_recommend==true)\").field(\r\n\t\t\t\t\t\"code,name,first_letter,is_recommend\").orderBy(\r\n\t\t\t\t\t\"first_letter asc,name asc\").limit(this.limit).get().then(({\r\n\t\t\t\t\tresult\r\n\t\t\t\t}) => {\r\n\t\t\t\t\tconsole.log(result)\r\n\t\t\t\t\tlet letter = \"\";\r\n\t\t\t\t\tlet data = [];\r\n\t\t\t\t\tlet extNames = [\"省直辖县级行政区划\", \"自治区直辖县级行政区划\", \"县\"];\r\n\t\t\t\t\tlet recommend = [];\r\n\t\t\t\t\tresult.data.map(item => {\r\n\t\t\t\t\t\tif (item.first_letter != letter) {\r\n\t\t\t\t\t\t\tif (letter) {\r\n\t\t\t\t\t\t\t\t//插入到原数组里面\r\n\t\t\t\t\t\t\t\tthis.dataList.push({\r\n\t\t\t\t\t\t\t\t\tletter: letter,\r\n\t\t\t\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//新起一个数组\r\n\t\t\t\t\t\t\tletter = item.first_letter;\r\n\t\t\t\t\t\t\tdata = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//暂且认为城市名称不重复，这几条要排除在外:省直辖县级行政区划、自治区直辖县级行政区划、县\r\n\t\t\t\t\t\tif (extNames.indexOf(item.name) == -1) {\r\n\t\t\t\t\t\t\tdata.push(item.name)\r\n\t\t\t\t\t\t\tif (item.is_recommend) {\r\n\t\t\t\t\t\t\t\trecommend.push(item.name)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//判断直辖市\r\n\t\t\t\t\t\t\tif (this.zhixiashi[item.name]) {\r\n\t\t\t\t\t\t\t\tthis.codeList[item.name] = this.zhixiashi[item.name];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.codeList[item.name] = item.code;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t//推荐列表\r\n\t\t\t\t\tif (recommend.length > 0) {\r\n\t\t\t\t\t\tthis.dataList.unshift({\r\n\t\t\t\t\t\t\tletter: this.hotLetter,\r\n\t\t\t\t\t\t\tdata: recommend\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//最后一个数组\r\n\t\t\t\t\tthis.dataList.push({\r\n\t\t\t\t\t\tletter: letter,\r\n\t\t\t\t\t\tdata: data\r\n\t\t\t\t\t})\r\n\t\t\t\t\t//获取当前定位城市\r\n\t\t\t\t\tthis.getLocation();\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetLocationCallback(e) {\r\n\t\t\t\tconsole.log(\"getLocation\", e)\r\n\t\t\t\t//根据经纬度，获得城市\r\n\t\t\t\tthis.$request(\"utils/getLocationAddress\", {\r\n\t\t\t\t\tfromLatlng: [e.latitude, e.longitude].join()\r\n\t\t\t\t}).then(data => {\r\n\t\t\t\t\tconsole.log(\"data\", data)\r\n\t\t\t\t\tif (data.ad_info) {\r\n\t\t\t\t\t\t//需要处理直辖市\r\n\t\t\t\t\t\tif (this.codeList[data.ad_info.district]) {\r\n\t\t\t\t\t\t\t//区县\r\n\t\t\t\t\t\t\tthis.localCity = {\r\n\t\t\t\t\t\t\t\tname: data.ad_info.district + \"（当前定位）\",\r\n\t\t\t\t\t\t\t\trealName: data.ad_info.district,\r\n\t\t\t\t\t\t\t\tcode: this.codeList[data.ad_info.district]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (this.zhixiashi[data.ad_info.province]) {\r\n\t\t\t\t\t\t\tthis.localCity = {\r\n\t\t\t\t\t\t\t\tname: data.ad_info.province + \"（当前定位城市）\",\r\n\t\t\t\t\t\t\t\trealName: data.ad_info.province,\r\n\t\t\t\t\t\t\t\tcode: this.zhixiashi[data.ad_info.province]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t//普通城市\r\n\t\t\t\t\t\t\tthis.localCity = {\r\n\t\t\t\t\t\t\t\tname: data.ad_info.city + \"（当前定位城市）\",\r\n\t\t\t\t\t\t\t\trealName: data.ad_info.city,\r\n\t\t\t\t\t\t\t\tcode: this.codeList[data.ad_info.city]\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconsole.log(\"this.localCity\", this.localCity)\r\n\t\t\t\t\t\t//判断是否存在热门\r\n\t\t\t\t\t\tlet hot = this.dataList[0].letter == this.hotLetter;\r\n\t\t\t\t\t\tthis.codeList[this.localCity.name] = this.localCity.code;\r\n\t\t\t\t\t\tif (hot) {\r\n\t\t\t\t\t\t\tlet localIndex = this.dataList[0].data.findIndex(e => this\r\n\t\t\t\t\t\t\t\t.localCity.name\r\n\t\t\t\t\t\t\t\t.indexOf(e) == 0);\r\n\t\t\t\t\t\t\tif (localIndex != -1) {\r\n\t\t\t\t\t\t\t\tthis.dataList[0].data.splice(localIndex, 1)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.dataList[0].data.unshift(this.localCity.name)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.dataList.unshift({\r\n\t\t\t\t\t\t\t\tletter: this.hotLetter,\r\n\t\t\t\t\t\t\t\tdata: [\r\n\t\t\t\t\t\t\t\t\tthis.localCity.name\r\n\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetLocation() {\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\twx.getFuzzyLocation({\r\n\t\t\t\t\ttype: 'wgs84',\r\n\t\t\t\t\tsuccess: (e) => {\r\n\t\t\t\t\t\tthis.getLocationCallback(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifndef MP-WEIXIN\r\n\t\t\t\tuni.getLocation({\r\n\t\t\t\t\tsuccess: (e) => {\r\n\t\t\t\t\t\tthis.getLocationCallback(e)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tasync chooseCity(e) {\r\n\t\t\t\tconsole.log(\"chooseCity\", e, this.codeList[e.item.name])\r\n\t\t\t\tlet city = {\r\n\t\t\t\t\tcode: this.codeList[e.item.name],\r\n\t\t\t\t\tname: e.item.name\r\n\t\t\t\t}\r\n\t\t\t\t//判断选择的城市是否为定位城市\r\n\t\t\t\tif (this.localCity && this.localCity.code == city.code) {\r\n\t\t\t\t\tcity.name = this.localCity.realName;\r\n\t\t\t\t}\r\n\t\t\t\tuni.setStorage({\r\n\t\t\t\t\tkey: \"user_select_city\",\r\n\t\t\t\t\tdata: city\r\n\t\t\t\t});\r\n\t\t\t\tif (this.save && this.isLogin) {\r\n\t\t\t\t\tawait db.collection(\"uni-id-users\").where(\"_id==$cloudEnv_uid\").update({\r\n\t\t\t\t\t\tselect_city: city\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//刷新用户信息\r\n\t\t\t\t\tthis.$store.dispatch('user/getUserInfo');\r\n\t\t\t\t}\r\n\t\t\t\tthis.$success(\"设置成功\");\r\n\t\t\t\t//城市更新事件\r\n\t\t\t\tuni.$emit(\"updateGlobelCity\", city)\r\n\t\t\t\tthis.navTimeBack(true, 1500, () => {\r\n\t\t\t\t\t//重新加载首页\r\n\t\t\t\t\tthis.$store.dispatch('app/init', {\r\n\t\t\t\t\t\tcity\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\r\n</style>\n"],"sourceRoot":""}