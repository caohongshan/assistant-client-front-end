(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["uni_modules/tian-mall/components/tian-goods-sku/tian-goods-sku"],{"00b3":function(e,t,i){},"28ac":function(e,t,i){"use strict";(function(e,n){var s=i("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(i("448a")),u=s(i("9523"));function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){(0,u.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var c=e.database(),l={data:function(){return{item:{},stock:0,loaded:!1,single:!1,amount:1,where:"",options:{},divider:"&gt;",selectSku:{},selectNames:"",submitButtonGroup:[{text:"确定",backgroundColor:"#ff0000",color:"#fff"}],skus:[],nameHash:[],skuNames:[],skuMap:{},skuNamesMap:{}}},props:{value:{type:Object,default:function(){return{price:0,market_price:0,member:{}}}},isSubmitSku:{type:Number,default:0},sid:{type:String,default:""},group_buying_id:{type:String,default:""}},watch:{value:function(e){this.item=e,this.skuNames=e.sku_name?e.sku_name:[],this.loadData()},group_buying_id:function(e){console.log("watch group_buying_id",e)}},created:function(){this.item=this.value,this.skuNames=this.value.sku_name?this.value.sku_name:[],this.loadData()},methods:{loadData:function(){var e=this;if(this.item&&this.item._id){if(this.single=!1,this.skuNamesMap={},this.loaded=!1,!this.item.sku_name||0==this.item.sku_name.length)return console.log("商品没有规格"),this.loaded=!0,this.single=!0,this.selectSku={price:this.item.price,stock:this.item.remain_count,market_price:this.item.market_price,goods_thumb:this.item.goods_thumb},void(this.stock=this.item.remain_count);this.isSelect=!1,this.selectSku={};var t={},i=[];this.amount=1,console.log("this.skuNames",this.skuNames),this.skuNames.map((function(e){t[e]=[]})),console.log("this.item",this.item),this.$request("mall/cart/getsku",{where:{goods_id:this.item._id}}).then((function(n){var s=n.result,o={},u=[];e.stock=0;var a=e.sid;s.map((function(n){var s=n._id,c=r({},e.item.miaosha);c&&c.sku_id==n._id&&(n.market_price||(n.market_price=n.price),c.is_begin&&(c.price?n.price=c.price:n.price=parseInt(n.price*c.discount/100)),a||(a=n._id),c.is_show=!0),""==n.goods_thumb?delete n.goods_thumb:n.goods_thumb&&(n.goods_thumb=e.$thumbImg(n.goods_thumb,"168x168"));var l=n.sku_name.split(e.divider);if(o[n.sku_name]=r(r(r({},e.item),n),{},{sku_id:s,miaosha:c,sku_name:l.join("+")}),e.stock+=n.stock,l.map((function(i,n){if(e.skuNames[n]&&t[e.skuNames[n]]){var s=t[e.skuNames[n]].findIndex((function(e){return e.name==i}));-1==s&&t[e.skuNames[n]].push({name:i,checked:!1,enable:!0})}})),a==n._id&&(e.selectSku=o[n.sku_name],u=l,e.selectNames=l.join("，"),setTimeout((function(){e.$emit("change",e.selectSku)}),100)),l.length>1)for(var d=0;d<l.length-1;d++){var m=[l[d]];i.push(l[d]);for(var h=d+1;h<l.length;h++)i.push(l[h]),i.push([l[d],l[h]].sort().join(e.divider)),m.push(l[h]);i.push(m.sort().join(e.divider))}else i=i.concat(l)}));var c={};if(u.length>0){var l=function(e){t[e].forEach((function(t){t.checked=-1!=u.indexOf(t.name),t.checked&&(c[e]=t.name)}))};for(var d in t)l(d)}e.skuNamesMap=t,e.skuMap=o,e.nameHash=e.unique(i),u.length>0&&setTimeout((function(){e.checkSkuEnable(u,c)}),100),e.loaded=!0}))}else console.log("sku 没有商品id")},unique:function(e){for(var t=[],i=0;i<e.length;i++)-1==t.indexOf(e[i])&&t.push(e[i]);return t},close:function(){this.$refs.skuPopup.close()},change:function(e){var t=e.show;t?n.hideTabBar():n.showTabBar()},open:function(){console.log("sku open"),this.$refs.skuPopup.open()},chooseSku:function(e,t,i){var n=this;if(!e.enable)return!1;e.checked=!e.checked,e.checked&&this.skuNamesMap[t].forEach((function(t){t.name!=e.name&&(t.checked=!1)}));var s=[],u=[],a={};for(var r in this.skuNamesMap){var c=this.skuNamesMap[r].filter((function(e){return e.checked}));c.length>0&&(s.push(c[0]),u.push(c[0].name),a[r]=c[0].name)}if(this.selectNames=u.join("，"),s.length==this.skuNames.length){var l=u.join(this.divider);this.selectSku=this.skuMap[l]}else this.selectSku={};var d=function(e){e!=t&&n.skuNamesMap[e].forEach((function(t){var i=u.filter((function(t){return t!=a[e]})),s=[].concat((0,o.default)(i),[t.name]).sort().join(n.divider);t.enable=-1!=n.nameHash.indexOf(s)}))};for(var m in this.skuNamesMap)d(m);this.$emit("change",this.selectSku)},checkSkuEnable:function(e,t){for(var i=this,n=0;n<e.length;n++){var s=function(s){s!=n&&i.skuNamesMap[s].forEach((function(n){var u=e.filter((function(e){return e!=t[s]})),a=[].concat((0,o.default)(u),[n.name]).sort().join(i.divider);n.enable=-1!=i.nameHash.indexOf(a)}))};for(var u in this.skuNamesMap)s(u)}},buttonClick:function(e){var t=this,i=e.index;if(console.log("buttonClick",i),this.checkBindMobile("必须绑定手机才能下单"))if(0==i)this.isSubmit=!0,n.showLoading({title:"请等待",mask:!0}),c.action("cart").collection("opendb-mall-cart").where({goods_id:this.item._id,sku_id:this.selectSku._id,user_id:c.env.uid}).update({goods_id:this.item._id,goods_name:this.selectSku.name,goods_thumb:this.selectSku.goods_thumb,shop_id:this.item.shop_id,sku_id:this.selectSku._id,sku_name:this.selectSku.sku_name,price:this.selectSku.price,market_price:this.selectSku.market_price,amount:+this.amount,user_id:c.env.uid}).then((function(e){var i=e.result;console.log("加入结果",i),i.updated?(t.$store.commit("mall/INCREMENT_CART_NUMBER",+t.amount),t.$success("加入成功")):t.$message("加入失败")})).catch((function(e){t.$message(e.message||"加入失败"),console.log("加入失败",e)})).finally((function(){t.isSubmitSku,t.close(),setTimeout((function(){t.isSubmit=!1}),1e3)}));else{this.close();var s=r(r({},this.selectSku),{},{goods_id:this.item._id,sku_id:this.selectSku._id,amount:this.amount});this.navTo("/pages/order/create",{type:"single",goods:[{group_buying:2==i,group_buying_id:this.group_buying_id,goods_id:this.item._id,sku_id:this.selectSku._id,amount:this.amount}],goodsList:[s]})}}}};t.default=l}).call(this,i("a9ff")["default"],i("543d")["default"])},"5a03":function(e,t,i){"use strict";i.r(t);var n=i("28ac"),s=i.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(o);t["default"]=s.a},b09b:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return n}));var n={uniPopup:function(){return i.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(i.bind(null,"49dc"))},tianGoodsPrice:function(){return i.e("uni_modules/tian-mall/components/tian-goods-price/tian-goods-price").then(i.bind(null,"720f"))},tianIcons:function(){return i.e("uni_modules/tian-mall/components/tian-icons/tian-icons").then(i.bind(null,"a527"))},uniLoadMore:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-load-more/components/uni-load-more/uni-load-more")]).then(i.bind(null,"345c"))},uniNumberBox:function(){return i.e("uni_modules/uni-number-box/components/uni-number-box/uni-number-box").then(i.bind(null,"2754"))},tianGoodsNav:function(){return i.e("uni_modules/tian-mall/components/tian-goods-nav/tian-goods-nav").then(i.bind(null,"64bb"))}},s=function(){var e=this,t=e.$createElement,i=(e._self._c,e.selectSku._id||e.single||e.selectNames?null:e.__map(e.skuNames,(function(t,i){var n=e.__get_orig(t),s=e.skuNames.length;return{$orig:n,g0:s}})));e.$mp.data=Object.assign({},{$root:{l0:i}})},o=[]},b631:function(e,t,i){"use strict";i.r(t);var n=i("b09b"),s=i("5a03");for(var o in s)["default"].indexOf(o)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(o);i("bd27");var u=i("f0c5"),a=Object(u["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=a.exports},bd27:function(e,t,i){"use strict";var n=i("00b3"),s=i.n(n);s.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'uni_modules/tian-mall/components/tian-goods-sku/tian-goods-sku-create-component',
    {
        'uni_modules/tian-mall/components/tian-goods-sku/tian-goods-sku-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("b631"))
        })
    },
    [['uni_modules/tian-mall/components/tian-goods-sku/tian-goods-sku-create-component']]
]);
