(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/detail"],{"08cf":function(t,o,i){"use strict";i.r(o);var e=i("c9a1"),n=i("650a");for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(o,t,(function(){return n[t]}))}(s);i("e6cf");var u=i("f0c5"),a=Object(u["a"])(n["default"],e["b"],e["c"],!1,null,null,null,!1,e["a"],void 0);o["default"]=a.exports},"39b7":function(t,o,i){},"650a":function(t,o,i){"use strict";i.r(o);var e=i("a81c"),n=i.n(e);for(var s in e)["default"].indexOf(s)<0&&function(t){i.d(o,t,(function(){return e[t]}))}(s);o["default"]=n.a},"6ffe":function(t,o,i){"use strict";(function(t,o){var e=i("4ea4");i("3f59"),i("a9ff");e(i("66fd"));var n=e(i("08cf"));t.__webpack_require_UNI_MP_PLUGIN__=i,o(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},a81c:function(t,o,i){"use strict";(function(t,e){var n=i("4ea4");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var s=n(i("d067")),u=n(i("a91e")),a=t.database(),r={mixins:[s.default,u.default],components:{groupBuyingPage:function(){i.e("pages/product/components/group-buying").then(function(){return resolve(i("6412"))}.bind(null,i)).catch(i.oe)}},data:function(){return{preloaded:!1,loaded:!1,current:0,bottomOptions:[],buttonGroup:[],selectSku:{},defaultSkuId:"",group_buying_id:"",item:{},description:[],defaultPrice:0,allGroupBuying:[],groupBuying:[],groupBuyingTotal:0,maxShowAllGroupBuying:10,isSubmitSku:0}},onLoad:function(t){this.item=this.getItemData(),this.item||(this.item={}),this.item._id&&(this.preloaded=!0),t.id&&(this.item._id=t.id),t.sku&&(this.defaultSkuId=t.sku,this.defaultPrice=t.price),this.item.goods_thumb&&(this.item.goods_banner_imgs=[this.$thumbImg(this.item.goods_thumb,"750x750")]),this.loadData()},onPullDownRefresh:function(){console.log("刷新整页"),e.stopPullDownRefresh(),this.current=0,this.updateBottomOptions(),this.loadData()},onShow:function(){this.loaded&&this.getGroupBuying()},computed:{quanyiDescription:function(){return this.$store.state.app.customer.goods&&this.$store.state.app.customer.goods.priceDescription.quanyi?this.$store.state.app.customer.goods.priceDescription.quanyi:[]},customer:function(){return this.$store.state.app.customer?this.$store.state.app.customer:{}},priceDescription:function(){return this.$store.state.app.customer.goods&&this.$store.state.app.customer.goods.priceDescription.price?this.$store.state.app.customer.goods.priceDescription.price:[]},bottomStyle:function(){var t=0;return 0!=this.systemInfo.model.indexOf("iPhone 1")&&0!=this.systemInfo.model.indexOf("iPhone X")||(t=this.systemInfo.safeAreaInsets.bottom,t>this.systemInfo.safeArea.bottom&&(t=this.systemInfo.safeArea.bottom),t-=20),"background-color: #fff;padding-bottom:".concat(t,"rpx")}},methods:{showCoupon:function(){this.$refs.couponPopup.open()},getCoupon:function(t){var o=this;this.$request("mall/coupon/takeit",{id:t._id,shop_id:this.item.shop_id},{loading:!0}).then((function(){e.showModal({content:"领取成功",showCancel:!1,success:function(){o.closeCoupon()}})}),(function(t){e.showModal({content:t.message||"领取失败",showCancel:!1,success:function(){o.closeCoupon()}})}))},closeCoupon:function(){this.$refs.couponPopup.close()},loadData:function(){var t=this;a.action("goods_miaosha,goods_member,check_goods_favorite,goods_visite,goods_coupon").collection("opendb-mall-goods").where('_id=="'.concat(this.item._id,'"')).field("goods_sn,name,category_id,shop_id,keywords,comments,comment_total_rate,miaosha,goods_desc,goods_thumb,goods_summary,goods_banner_imgs,price,market_price,sku_name,is_vip,remain_count,month_sell_count,total_sell_count,comment_count,is_real,is_on_sale,is_alone_sale,is_best,is_new,is_hot,add_date,last_modify_date,use_score,use_score_rate,group_buying,group_buying_discount").get({getOne:!0}).then((function(o){var i=o.result;if(t.description=[],i.data.goods_desc&&i.data.goods_desc.length>0){new RegExp("(.jpg|.png|.jpeg|.gif)$");var e=new RegExp("(.mp4|.wma|.3gp)$"),n=[];i.data.goods_desc.map((function(o){if(o.indexOf("http")>-1)return e.test(o.toLowerCase())?(n.length>0&&t.description.push({type:"html",content:n.join("")}),n=[],void t.description.push({type:"video",content:o})):void n.push('<img src="'.concat(o,'" style="width:100%;display:block;"/>'));n.push('<p style="padding:12px;">'.concat(o,"</p>"))})),n.length>0&&t.description.push({type:"html",content:n.join("")}),console.log(t.description)}t.defaultPrice&&(i.data.price=t.defaultPrice),i.data.goods_banner_imgs||(i.data.goods_banner_imgs=[],i.data.goods_banner_imgs.unshift(i.data.goods_thumb)),t.item=i.data,t.preloaded=!0,t.loaded=!0,t.buildData(),t.updateBottomOptions(),t.getGroupBuying(),t.setGlobalShareContent(!1,{goods:i.data},"product/detail")})),this.updateBottomOptions(),this.$store.state.app&&this.$store.state.app.customer&&this.$store.state.app.customer.maxShowAllGroupBuying&&(this.maxShowAllGroupBuying=this.$store.state.app.customer.maxShowAllGroupBuying)},buildData:function(t){var o=this;this.item.goods_banner_imgs&&(this.item.goods_banner_imgs=this.item.goods_banner_imgs.map((function(t){return o.$thumbImg(t,"750x750")})))},getGroupBuying:function(){var t=this;if(this.item.group_buying){var o=this.$store.state.user.userInfo;a.collection("opendb-mall-goods-group-buying,uni-id-users").where('goods_id=="'.concat(this.item._id,'" && state==1')).field("group_id,user_id.avatar,user_id._id,user_id.nickname,end_time").orderBy("create_time asc").get().then((function(i){var e=i.result;console.log(e);var n={};t.groupBuyingTotal=0,e.data.map((function(i){var e=t.buildUserInfo(i.user_id[0]);n[i.group_id]||(n[i.group_id]={avatar:[],nickname:[],id:i.group_id,enable:!0,index:t.item.group_buying,amount:t.item.group_buying}),n[i.group_id].index--,e._id==o._id&&(n[i.group_id].enable=!1,n[i.group_id].index+=1e3),n[i.group_id].avatar.push(e.avatar),n[i.group_id].nickname.push(e.nickname),n[i.group_id].amount--,t.groupBuyingTotal++})),t.allGroupBuying=[];var s=[];for(var u in n)t.allGroupBuying.length<t.maxShowAllGroupBuying&&t.allGroupBuying.push(n[u]);t.allGroupBuying.sort((function(t,o){return t.index-o.index})),t.allGroupBuying.map((function(t){s.length<2&&s.push(t)})),t.groupBuying=s}))}},updateBottomOptions:function(){var t=[{icon:"dianpu",text:"首页"}];this.item.is_on_sale&&(this.item.is_fav?t.push({icon:"biaoxingfill",color:"#ff5a1d",text:"已收藏"}):t.push({icon:"biaoxing",color:"#646566",text:"收 藏"})),t.push({icon:"gouwuche",text:"购物车"}),this.bottomOptions=t,this.item.is_on_sale?(this.buttonGroup=[{text:"加入购物车",backgroundColor:"#ffa200",color:"#fff"},{text:"立即购买",backgroundColor:"#ff0000",color:"#fff"}],this.item.group_buying?this.buttonGroup=[{text:"立即购买",backgroundColor:"#aeaeae",color:"#fff"},{text:"拼单购买",backgroundColor:"#e64340",color:"#fff"}]:this.item.is_real||(this.buttonGroup=[{text:"立即购买",backgroundColor:"#ff0000",color:"#fff"}])):this.buttonGroup=[{text:"商品已下架",backgroundColor:"#878787",color:"#fff"}]},checkFav:function(){var t=this;a.collection("tian-mall-favorite").where("user_id==$cloudEnv_uid && type=='goods' && id==\"".concat(this.item._id,'"')).field("_id").get({getOne:!0}).then((function(o){var i=o.result;console.log("checkFav result",i.data),t.is_fav=!!i.data}))},saveFav:function(){var t=this;this.isLogin?this.item.is_fav?a.collection("tian-mall-favorite").where("user_id==$cloudEnv_uid && type=='goods' && id==\"".concat(this.item._id,'"')).remove().then((function(){t.$success("取消成功"),t.item.is_fav=!1,t.updateBottomOptions()})).catch((function(){e.hideLoading(),t.$message("取消失败")})):a.collection("tian-mall-favorite").add({id:this.item._id,title:this.item.name,avatar:this.item.goods_thumb,description:this.item.goods_summary,price:this.item.price,type:["goods"]}).then((function(){t.$success("收藏成功"),t.item.is_fav=!0,t.updateBottomOptions()})).catch((function(){e.hideLoading(),t.$message("收藏失败")})):this.navToLoginNotice((function(){t.checkFav()}))},change:function(t){this.current=t.detail.current},resetTabCartCount:function(){console.log("resetTabCartCount"),this.updateBottomOptions()},leftClick:function(t){0==t.index?e.switchTab({url:"/pages/index/index"}):1==t.index?this.saveFav():e.switchTab({url:"/pages/index/cart"})},buttonClick:function(t){this.item.is_on_sale&&(console.log("buttonClick",t.index,this.item),this.isSubmitSku=t.index+1,this.item.group_buying?(this.isSubmitSku=t.index+2,this.group_buying_id=""):this.item.is_real||(this.isSubmitSku=4),console.log("this.isSubmitSku",this.isSubmitSku),this.$refs.tianSkuPop.open())},openSku:function(){this.isSubmitSku=0,this.$refs.tianSkuPop.open()},changeSku:function(t){console.log("changeSku",t),this.selectSku=t},showMoreGb:function(){this.allGroupBuying.length>0&&this.$refs.gbPopup.open()},closeGb:function(){this.$refs.gbPopup.close()},changeGb:function(t){},btnGroupBuying:function(t){this.$refs.gbPopup.close(),this.isSubmitSku=4,this.group_buying_id=t,this.$refs.tianSkuPop.open()}}};o.default=r}).call(this,i("a9ff")["default"],i("543d")["default"])},c9a1:function(t,o,i){"use strict";i.d(o,"b",(function(){return n})),i.d(o,"c",(function(){return s})),i.d(o,"a",(function(){return e}));var e={tianGoodsPrice:function(){return i.e("uni_modules/tian-mall/components/tian-goods-price/tian-goods-price").then(i.bind(null,"720f"))},uniDateformat:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat")]).then(i.bind(null,"23e3"))},tianIcons:function(){return i.e("uni_modules/tian-mall/components/tian-icons/tian-icons").then(i.bind(null,"a527"))},tianGoodsSku:function(){return i.e("uni_modules/tian-mall/components/tian-goods-sku/tian-goods-sku").then(i.bind(null,"b631"))},tianGoodsNav:function(){return i.e("uni_modules/tian-mall/components/tian-goods-nav/tian-goods-nav").then(i.bind(null,"64bb"))},uniPopup:function(){return i.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(i.bind(null,"49dc"))}},n=function(){var t=this,o=t.$createElement,i=(t._self._c,t.preloaded?t.item.sku_name&&t.item.sku_name.length>0:null),e=t.preloaded?t.item.group_buying&&t.allGroupBuying.length>0:null,n=t.preloaded?t.description&&t.description.length>0:null,s=t.preloaded?t.allGroupBuying.length:null;t.$mp.data=Object.assign({},{$root:{g0:i,g1:e,g2:n,g3:s}})},s=[]},e6cf:function(t,o,i){"use strict";var e=i("39b7"),n=i.n(e);n.a}},[["6ffe","common/runtime","common/vendor"]]]);