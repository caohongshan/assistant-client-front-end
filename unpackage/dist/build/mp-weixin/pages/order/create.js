(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/create"],{"0f3a":function(t,e,o){"use strict";var n=o("35c9"),i=o.n(n);i.a},"35c9":function(t,e,o){},4165:function(t,e,o){"use strict";(function(t,e){var n=o("4ea4");o("3f59"),o("a9ff");n(o("66fd"));var i=n(o("9c98"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(i.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},"94fa":function(t,e,o){"use strict";o.r(e);var n=o("a281"),i=o.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},"9c98":function(t,e,o){"use strict";o.r(e);var n=o("acac"),i=o("94fa");for(var s in i)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("0f3a");var r=o("f0c5"),a=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=a.exports},a281:function(t,e,o){"use strict";(function(t){var n=o("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(o("9523"));function s(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function r(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?s(Object(o),!0).forEach((function(e){(0,i.default)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var a={data:function(){return{symbol:"￥",message:"无",coupons:"未选择",goodsTotal:0,order:{},formData:{coupon:"",invoice:"",discount:0,freight:0,score:0,total:0,needAddress:!1,mustUseScore:!1,exchangePointsForCash:!1,remarks:"无",delivery_type:"express",canUseScore:0,usedScore:0,score2moneyRate:0,address:{},goodsList:[]}}},computed:{remarks:function(){return this.formData.remarks?this.formData.remarks:"无"},invoice:function(){return!this.formData.invoice||this.formData.invoice_type&&"none"==this.formData.invoice_type?"不开发票":this.formData.invoice},freightText:function(){return 0==this.formData.freight?"免运费":this.symbol+(this.formData.freight/100).toFixed(2)},discountText:function(){return this.symbol+(this.formData.discount/100).toFixed(2)},scoreName:function(){return this.$store.state.app.customer.scoreName?this.$store.state.app.customer.scoreName:"积分"},exchangeScoreName:function(){return this.scoreName+"兑换"},useScoreName:function(){return"使用"+this.scoreName},totalText:function(){var t=0;return this.formData.exchangePointsForCash&&(t=this.formData.usedScore*this.formData.score2moneyRate),((this.goodsTotal-this.formData.discount)/100-t).toFixed(2)},goodsTotalText:function(){return this.symbol+(this.goodsTotal/100).toFixed(2)},scoreText:function(){return"总"+this.scoreName+"总:"+this.formData.score+"，其中"+this.formData.canUseScore+this.scoreName+"可用"},scoreResultText:function(){return this.formData.usedScore<1?"不使用":"已选择"+this.formData.usedScore+this.scoreName},scoreMoneyResultText:function(){return this.formData.usedScore+""},userInfo:function(){return this.$store.state.user.userInfo}},onLoad:function(){this.editData(this.getItemData())},onShow:function(){this.loadData(),t.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#eb4e38",animation:{duration:400,timingFunc:"easeIn"},success:function(){console.log("success")},fail:function(t){console.log("fail",t)}})},onUnload:function(){t.removeStorage({key:this.itemDataKey})},methods:{loadData:function(){var t=this;this.$request("mall/order/settlement",r(r({},this.formData),{},{usedScore:0,coupons:void 0,couponsDisabled:void 0,couponsChecked:void 0,coupon_id:"",address:void 0,goodsList:void 0}),{loading:!0}).then((function(e){t.editData(e)}),(function(e){t.navTimeBack()})),this.buildTotal()},buildTotal:function(){var t=0;this.formData.goodsList.map((function(e){t+=e.price*e.amount})),this.goodsTotal=t},editData:function(e){if(e.coupons){t.setStorage({key:"order_coupon",data:e.coupons});var o=t.getStorageSync("order_select_coupon");o&&e.coupons.filter((function(t){return t._id==o._id})).length>0&&(e.couponsChecked=o),0==e.coupons.length&&(this.coupons="无可用优惠券")}for(var n in e.couponsDisabled&&t.setStorage({key:"order_coupon_couponsDisabled",data:e.couponsDisabled}),e.couponsChecked&&e.couponsChecked._id&&(this.coupons="已选择",e.couponsChecked.discount&&(e.discount+=e.couponsChecked.discount)),e)this.$set(this.formData,n,e[n]);this.goodsTotal=e.total},changeScore:function(){var e=this;return this.userInfo.score<1?(this.$message("积分不足"),!1):this.formData.canUseScore<1?(this.$message("积分不可用"),!1):void t.showModal({title:"使用积分",editable:!0,content:this.formData.usedScore?this.formData.usedScore:"",success:function(t){t.confirm&&e.confirmEditScore(t.content)}})},confirmEditScore:function(t){t<0&&(t=0),t>this.formData.canUseScore&&(t=this.formData.canUseScore),this.formData.usedScore=+t},changeInvoice:function(){var e=this;t.showModal({editable:!0,title:"请输入发票抬头",placeholderText:"请输入公司/个人名称",success:function(t){t.confirm&&(console.log(t.content),e.invoice=t.content,e.formData.invoice=t.content)}})},changeComment:function(){var e=this;t.showModal({editable:!0,title:"请输入留言",content:this.formData.remarks,success:function(t){t.confirm&&(e.formData.remarks=t.content)}})},confirmEditComment:function(t){this.formData.remarks=t},submit:function(){var e=this;this.formData.goodsList?(console.log(r(r({},this.formData),{},{address:void 0,goodsList:void 0,submit:!0,address_id:this.formData.address._id})),this.$request("mall/order/settlement",r(r({},this.formData),{},{coupons:void 0,couponsDisabled:void 0,couponsChecked:void 0,address:void 0,goodsList:void 0,submit:!0,address_id:this.formData.address._id}),{loading:!0}).then((function(o){e.order=o,o.page?t.redirectTo({url:o.page}):e.$refs.payment.open()}),(function(t){console.log("下单失败")}))):this.$message("商品不能为空")},closePayment:function(){},paySuccess:function(e){console.log("pay success",e),e.id.indexOf(",")>-1?t.redirectTo({url:"/pages/order/order?type=undelivery"}):t.redirectTo({url:"/pages/order/detail?id="+e.id})}}};e.default=a}).call(this,o("543d")["default"])},acac:function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return n}));var n={tianIcons:function(){return o.e("uni_modules/tian-mall/components/tian-icons/tian-icons").then(o.bind(null,"a527"))},tianEmpty:function(){return o.e("uni_modules/tian-mall/components/tian-empty/tian-empty").then(o.bind(null,"2fd8"))},tianGoodsPrice:function(){return o.e("uni_modules/tian-mall/components/tian-goods-price/tian-goods-price").then(o.bind(null,"720f"))},uniList:function(){return o.e("uni_modules/uni-list/components/uni-list/uni-list").then(o.bind(null,"7f52"))},uniListItem:function(){return o.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(o.bind(null,"a5e7"))},tianPayment:function(){return o.e("uni_modules/tian-mall/components/tian-payment/tian-payment").then(o.bind(null,"f09a"))}},i=function(){var t=this,e=t.$createElement,o=(t._self._c,t.__map(t.formData.goodsList,(function(e,o){var n=t.__get_orig(e),i=t.$thumbImg(e.goods_thumb,"140x140");return{$orig:n,m0:i}})));t.$mp.data=Object.assign({},{$root:{l0:o}})},s=[]}},[["4165","common/runtime","common/vendor"]]]);