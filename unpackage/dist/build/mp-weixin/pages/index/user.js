(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/user"],{3096:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o}));var o={tianIcons:function(){return n.e("uni_modules/tian-mall/components/tian-icons/tian-icons").then(n.bind(null,"a527"))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,"49dc"))},uniPopupDialog:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog")]).then(n.bind(null,"b498"))}},s=function(){var e=this,t=e.$createElement,n=(e._self._c,e.adminShops&&e.adminShops.length>0),o=n?e.__map(e.adminShops,(function(t,n){var o=e.__get_orig(t),s=e.$thumbImg(t.src,"80x80");return{$orig:o,m0:s}})):null;e.$mp.data=Object.assign({},{$root:{g0:n,l0:o}})},i=[]},"3a6e":function(e,t,n){"use strict";n.r(t);var o=n("9ac5"),s=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=s.a},"61f1":function(e,t,n){"use strict";n.r(t);var o=n("3096"),s=n("3a6e");for(var i in s)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(i);n("c5b5");var a=n("f0c5"),r=Object(a["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=r.exports},9524:function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("3f59"),n("a9ff");o(n("66fd"));var s=o(n("61f1"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(s.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"9ac5":function(e,t,n){"use strict";(function(e,o){var s=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=s(n("2eee")),a=s(n("c973")),r=s(n("9523")),u=s(n("d067")),c=s(n("c16b")),l=n("67bc");function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=e.database(),g={mixins:[u.default,c.default],data:function(){return{hasSign:!1,isLocalLogin:!1,adminShops:[],showTeamPopup:!1,taskBtnText:"",signTask:{},orderList:[],stateMap:{},optionDataList:[],options:h({},l.enumConverter)}},computed:{isLogin:function(){return this.$store.getters["user/isTokenValid"]},userInfo:function(){return this.$store.state.user.userInfo},userScore:function(){return parseInt(this.userInfo.score)},adConfig:function(){return this.$store.state&&this.$store.state.app.adConfig&&this.$store.state.app.adConfig.tasks?this.$store.state.app.adConfig.tasks:{}},scoreName:function(){return this.$store.state.app.customer.scoreName?this.$store.state.app.customer.scoreName:"积分"}},watch:{stateMap:function(e){console.log("watch stateMap",e),this.initOrder()}},onPullDownRefresh:function(){console.log("用户刷新整页"),this.getStatistics(),o.stopPullDownRefresh()},onLoad:function(){o.hideLoading(),this.initOrder(),this.initOptions()},onShow:function(){console.log("user onShow"),this.isLocalLogin||this.getStatistics()},methods:{loadData:function(){this.getStatistics()},getStatistics:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n,o,s;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isLogin){t.next=13;break}return e.$request("user/info/info").then((function(t){console.log("user statitics",t),e.$store.commit("user/SET_USER_INFO",t),e.initOptions()}),(function(e){console.log("getStatistics err",e)})),e.getSignTask(),n={},t.next=6,f.collection("tian-mall-order-refunds").where("user_id==$cloudEnv_uid").count();case 6:o=t.sent,s=o.result.total,n["refund"]=s,f.collection("tian-mall-orders").where("user_id==$cloudEnv_uid && is_delete==0 && state>=0").groupBy("state").groupField("count(*) as total").get().then((function(t){var o=t.result;o.data.forEach((function(e){n[e.state]=e.total})),e.stateMap=n})),e.getShopAdmin(),t.next=17;break;case 13:e.isLocalLogin=!1,e.stateMap={},e.initOptions(),e.adminShops=[];case 17:case"end":return t.stop()}}),t)})))()},getShopAdmin:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n,o,s,a;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,f.collection("tian-mall-shops").where("uid==$cloudEnv_uid || employees==$cloudEnv_uid").field("name,id,src,online,address,phone,apply_id").limit(20).get();case 2:return n=t.sent,o=n.result,s=[],o.data.forEach((function(e){e.page="/pages/enterprise/detail",e.apply_id&&s.push(e.apply_id)})),t.next=8,e.getShopApply(s);case 8:a=t.sent,e.adminShops=o.data.concat(a),console.log("tian-mall-shops",o);case 11:case"end":return t.stop()}}),t)})))()},getShopApply:function(e){var t=this;return(0,a.default)(i.default.mark((function n(){var o,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,f.collection("tian-mall-shop-apply").where("uid==$cloudEnv_uid").field("name,src,address,phone,id,state,apply_result").limit(200).get();case 2:return o=n.sent,s=o.result,n.abrupt("return",s.data.filter((function(t){return-1==e.indexOf(t._id)})).map((function(e){return e.isApply=!0,e.page="/pages/enterprise/apply?id="+e._id,e.stateText=t.options.state_valuetotext[e.state],0==e.state&&(e.apply_result=!1),e})));case 5:case"end":return n.stop()}}),n)})))()},getSignTask:function(){var e=this;this.$request("user/info/sign_task",{},{}).then((function(t){e.buildSignTask(t)}))},buildSignTask:function(e){e&&(this.hasSign=!0,this.taskBtnText="签到",e.log&&e.log.result&&(this.taskBtnText="已签到",e.open_url=!1),this.signTask=e,console.log("this.signTask",this.signTask))},buildTaskResult:function(e){delete e.task,this.signTask.log=e,this.buildSignTask(this.signTask)},navToSign:function(){this.signTask.open_url?this.navTo(this.signTask.open_url,this.signTask):this.$message("今日已签到")},logout:function(){var e=this;this.confirmAction((function(){e.$request("user/login/logout").then((function(t){console.log("退出成功",t),e.localLogout()}),(function(t){console.log("退出失败",t),e.localLogout()}))}),"是否确定退出系统？")},localLogout:function(){this.$store.commit("user/REMOVE_TOKEN"),this.$store.commit("user/SET_USER_INFO",{}),this.$store.commit("mall/UPDATE_CART_NUMBER",0),this.stateMap={}},checkTeam:function(){this.navTo("/pages/user/team/team")},closeInvite:function(){var e=this;o.showModal({title:"邀请提示",content:"是否确定放弃填写邀请人的权利？",confirmText:"放弃权利",cancelText:"暂时不填",success:function(t){t.confirm?e.$request("user/info/jointeam",{mobile:"none"},{loading:!0}).then((function(t){console.log("jointeam",t),e.$store.dispatch("user/getUserInfo"),e.navTo("/pages/user/team")})):e.$refs.teamPopup.close()}})},confirmInvite:function(e){var t=this;if(!e)return this.$message("请填写邀请码"),!1;this.$request("user/info/jointeam",{mobile:e},{loading:!0}).then((function(e){console.log("jointeam",e),t.$success("邀请成功"),t.$store.dispatch("user/getUserInfo"),t.$refs.teamPopup.close()}))},initOptions:function(){var e=[{type:"gouwudai",text:"分销业绩",checkLogin:!0,open_url:"/pages/user/achievement"},{type:"renwu",text:"每日任务",checkLogin:!0,checkMobile:!1,open_url:"/pages/user/tasks"},{type:"fenxiang",text:"分享好友",checkLogin:!0,checkMobile:!1,open_url:"/pages/user/invite"},{type:"shangji1",text:"申请渠道",checkLogin:!0,checkMobile:!0,open_url:"/pages/user/channel?type=1"},{type:"shoucang",text:"我的收藏",checkLogin:!0,open_url:"/pages/user/favorite"},{type:"liuyan",text:"我的消息",checkLogin:!0,open_url:"/pages/index/chat"},{type:"zuobiao",text:"收货地址",checkLogin:!0,open_url:"/pages/address/list"},{type:"tongji",text:this.scoreName+"排行",checkLogin:!0,open_url:"/pages/user/score/ranking"},{type:"gonglve",text:"余额明细",checkLogin:!0,open_url:"/pages/user/balances"},{type:"liebiaoxingshi",text:this.scoreName+"明细",checkLogin:!0,open_url:"/pages/user/scores"},{type:"zhengli",text:this.scoreName+"互转",checkLogin:!0,open_url:"/pages/user/score/transfer"},{type:"tuikuan",text:this.scoreName+"兑换",checkLogin:!0,open_url:"/pages/user/score/cashout"},{type:"hongbao",text:"余额提现",checkLogin:!0,open_url:"/pages/user/cashout"},{type:"shezhi",text:"个人设置",checkLogin:!0,open_url:"::navToUserInfo"},{type:"kefu",text:"联系客服",open_url:"/pages/app/contact"}];e.unshift({type:"pengyou",text:"我的团队",checkLogin:!0,checkMobile:!1,open_url:"::checkTeam"}),e.unshift({type:"dianpu",text:"门店入驻",checkLogin:!0,checkMobile:!0,open_url:"/pages/enterprise/apply"}),this.userInfo&&this.userInfo.role&&-1!=this.userInfo.role.indexOf("admin")&&e.push({type:"danpin",text:"系统管理",mustLogin:!0,open_url:"/pages/admin/admin"}),e.forEach((function(e,t){parseInt(t/5),e.color="#ec6535"})),this.optionDataList=e},initOrder:function(){var e=this,t=[{type:"baoguofahuo-xianxing",text:"待付款",checkLogin:!0,state:0,open_url:"/pages/order/order?type=unpay"},{type:"baoguofahuo",text:"待发货",checkLogin:!0,state:1,open_url:"/pages/order/order?type=undelivery"},{type:"yunshuzhongwuliu",text:"待收货",checkLogin:!0,state:2,open_url:"/pages/order/order?type=unreceived"},{type:"liuyanfill",text:"待评价",checkLogin:!0,state:3,open_url:"/pages/order/comment"},{type:"chaibaoguoqujian",text:"退换货",checkLogin:!0,state:"refund",open_url:"/pages/order/service"}];t.forEach((function(t,n){e.stateMap[t.state]?t.total=e.stateMap[t.state]:t.total=0,parseInt(n/5)%2==1?t.color="#51b2f9":t.color="#ec6535"})),this.orderList=t},getPhoneNumber:function(e){var t=this;console.log("getPhoneNumber",e),e.detail.iv&&this.$request("user/login/weixin_phone",h(h({},e.detail),{},{sessionKey:this.$store.state.user.sessionKey,uid:this.$store.state.user.userInfo._id,openid:this.$store.state.user.openid}),{loading:!0}).then((function(e){console.log("getPhoneNumber",e),t.getStatistics()}))},navToUserInfo:function(){this.navTo("/pages/user/info",{},{login:!0})},editData:function(e){var t=this;console.log("editData",e),this.$request("user/info/edit",e,{loading:!0}).then((function(e){t.$store.dispatch("user/getUserInfo")}))},changeAccount:function(){}}};t.default=g}).call(this,n("a9ff")["default"],n("543d")["default"])},c5b5:function(e,t,n){"use strict";var o=n("ce09"),s=n.n(o);s.a},ce09:function(e,t,n){}},[["9524","common/runtime","common/vendor"]]]);